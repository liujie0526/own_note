## dstat 工具

#### 介绍

dstat 是一个可以取代vmstat，iostat，netstat和ifstat这些命令的多功能产品。dstat克服了这些命令的局限并增加了一些另外的功能，增加了监控项，也变得更灵活了。dstat可以很方便监控系统运行状况并用于基准测试和排除故障。
dstat可以让你实时地看到所有系统资源，例如，你能够通过统计IDE控制器当前状态来比较磁盘利用率，或者直接通过网络带宽数值来比较磁盘的吞吐率（在相同的时间间隔内）。
dstat将以列表的形式为你提供选项信息并清晰地告诉你是在何种幅度和单位显示输出。这样更好地避免了信息混乱和误报。更重要的是，它可以让你更容易编写插件来收集你想要的数据信息，以从未有过的方式进行扩展。
dstat的默认输出是专门为人们实时查看而设计的，不过你也可以将详细信息通过CSV输出到一个文件，并导入到Gnumeric或者Excel生成表格中。

* 结合了vmstat，iostat，ifstat，netstat以及更多的信息
* 实时显示统计情况
* 在分析和排障时可以通过启用监控项并排序
* 模块化设计
* 使用python编写的，更方便扩展现有的工作任务
* 容易扩展和添加你的计数器
* 包含的许多扩展插件充分说明了增加新的监控项目是很方便的
* 可以分组统计块设备/网络设备，并给出总数
* 可以显示每台设备的当前状态
* 极准确的时间精度，即便是系统负荷较高也不会延迟显示
* 显示准确地单位和和限制转换误差范围
* 用不同的颜色显示不同的单位
* 显示中间结果延时小于1秒
* 支持输出CSV格式报表，并能导入到Gnumeric和Excel以生成图形

#### 安装

`yum install dstat`

#### 使用

在命令行输入`dstat`命令，打开dstat工具。

执行 dstat 命令的时候，默认他会 收集-cpu-、-disk-、-net-、－paging-、-system-的数据，一秒钟收集一次。默认输入 dstat 等于输入了dstat -cdngy 1或dstat -a 1

默认输出显示的信息：

```shell
CPU状态：CPU的使用率。这项报告更有趣的部分是显示了用户，系统和空闲部分，这更好地分析了CPU当前的使用状况。如果你看到”wait”一栏中，CPU的状态是一个高使用率值，那说明系统存在一些其它问题。当CPU的状态处在”waits”时，那是因为它正在等待I/O设备（例如内存，磁盘或者网络）的响应而且还没有收到。
磁盘统计：磁盘的读写操作，这一栏显示磁盘的读、写总数。
网络统计：网络设备发送和接受的数据，这一栏显示的网络收、发数据总数。
分页统计：系统的分页活动。分页指的是一种内存管理技术用于查找系统场景，一个较大的分页表明系统正在使用大量的交换空间，或者说内存非常分散，大多数情况下你都希望看到page in（换入）和page out（换出）的值是0 0。
系统统计：这一项显示的是中断（int）和上下文切换（csw）。这项统计仅在有比较基线时才有意义。这一栏中较高的统计值通常表示大量的进程造成拥塞，需要对CPU进行关注。你的服务器一般情况下都会运行运行一些程序，所以这项总是显示一些数值。
默认情况下，dstat每秒都会刷新数据。如果想退出dstat，你可以按”CTRL-C”键。
需要注意的是报告的第一行，通常这里所有的统计都不显示数值的。
这是由于dstat会通过上一次的报告来给出一个总结，所以第一次运行时是没有平均值和总值的相关数据。
```

dstat 也可以收集指定的性能资源。使用 `dstat -h` 可以看到相应的参数。

常用的参数如下：

```shell
-–disk-util    #显示某一时间磁盘的忙碌状况
-–freespace    #显示当前磁盘空间使用率
-–proc-count    #显示正在运行的程序数量
-–top-bio    #指出块I/O最大的进程
-–top-cpu    #图形化显示CPU占用最大的进程
-–top-io    #显示正常I/O最大的进程
-–top-mem    #显示占用最多内存的进程
```

#### 输出结果到csv文件

`dstat –output /tmp/sampleoutput.csv -cdn`