
## **vmstat命令详解**
vmstat命令是最常见的Linux/Unix监控工具，可以展现给定时间间隔的服务器的状态值,包括服务器的CPU使用率，内存使用，虚拟内存交换情况,IO读写情况。

**命令格式**  
`vmstat [-V] [-n] [delay [count]]`

**输出格式**   
	
	vmstat   
	procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
	 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	 0  0      0 1374596  42448 311024    0    0   199    24   51   75  1  1 97  1  0	
	
	vmstat 2
	procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----
	 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
	 0  0      0 1373324  42512 312076    0    0   190    23   50   74  1  1 97  1  0	
	 0  0      0 1373308  42512 312076    0    0     0     0   26   41  0  0 100  0  0	
	 0  0      0 1373308  42512 312076    0    0     0     0   23   37  0  0 100  0  0	
	 0  0      0 1373308  42512 312076    0    0     0     0   25   38  0  0 100  0  0	
	^C

单独使用vmstat命令时，会得到系统当前的状态值。可以通过在后面加两个数字来控制输出。第一个数字为抓取间隔，第二个数字为抓取次数。如果不交代抓取次数，命令会一直进行下去，直到人为停止。

**参数详解**   
r 表示运行队列(就是说多少个进程真的分配到CPU)

b 表示阻塞的进程

swpd 虚拟内存已使用的大小，如果大于0，表示你的机器物理内存不足了，如果不是程序内存泄露的原因，那么你该升级内存了或者把耗内存的任务迁移到其他机器。

free   空闲的物理内存的大小，我的机器内存总共8G，剩余3415M。

buff   Linux/Unix系统是用来存储，目录里面有什么内容，权限等的缓存

cache cache直接用来记忆我们打开的文件,给文件做缓冲

si  每秒从磁盘读入虚拟内存的大小，如果这个值大于0，表示物理内存不够用或者内存泄露了，要查找耗内存进程解决掉

so  每秒虚拟内存写入磁盘的大小，如果这个值大于0，同上

bi  块设备每秒接收的块数量，这里的块设备是指系统上所有的磁盘和其他块设备，默认块大小是1024byt

bo 块设备每秒发送的块数量，例如我们读取文件，bo就要大于0。bi和bo一般都要接近0，不然就是IO过于频繁，需要调整

in 每秒CPU的中断次数，包括时间中断

cs 每秒上下文切换次数，例如我们调用系统函数，就要进行上下文切换，线程的切换，也要进程上下文切换，这个值要越小越好，太大了，要考虑调低线程或者进程的数目,例如在apache和nginx这种web服务器中，我们一般做性能测试时会进行几千并发甚至几万并发的测试，选择web服务器的进程可以由进程或者线程的峰值一直下调，压测，直到cs到一个比较小的值，这个进程和线程数就是比较合适的值了。系统调用也是，每次调用系统函数，我们的代码就会进入内核空间，导致上下文切换，这个是很耗资源，也要尽量避免频繁调用系统函数。上下文切换次数过多表示你的CPU大部分浪费在上下文切换，导致CPU干正经事的时间少了，CPU没有充分利用，是不可取的

us 用户CPU时间

sy 系统CPU时间，如果太高，表示系统调用时间长，例如是IO操作频繁

id  空闲CPU时间，一般来说，id + us + sy = 100,一般我认为id是空闲CPU使用率，us是用户CPU使用率，sy是系统CPU使用率

wt 等待IO CPU时间
